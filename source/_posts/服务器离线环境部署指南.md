---
title: 服务器离线环境部署指南
date: 2025-07-31 17:17:50
excerpt: Linux服务器处于离线环境时，许多资源无法一步到位，需要手动部署相关依赖环境，过程繁琐且易遇到奇奇怪怪的问题，现将完美解决方案进行记录，便于后续有类似需求时提高处理效率
tags: 
  - Linux环境离线部署
categories:
  - [学习,环境部署]
---

# 1. VSCode插件离线安装

插件安装包下载地址：https://marketplace.visualstudio.com/

> 若该地址下载的插件安装包无法正确安装，可以来到插件对应的GitHub地址进行下载后缀为.vsix的安装包，例子如下：

<img src="https://z-cloud-pic-1313046262.cos.ap-guangzhou.myqcloud.com/img/202507311718499.png" alt="image-20250723181704821" style="zoom:50%;" />

<img src="https://z-cloud-pic-1313046262.cos.ap-guangzhou.myqcloud.com/img/202507311718497.png" alt="image-20250723181736397" style="zoom:67%;" />

<img src="https://z-cloud-pic-1313046262.cos.ap-guangzhou.myqcloud.com/img/202507311718492.png" alt="image-20250723181757154" style="zoom:50%;" />

下载完安装包后，通过XFTP将文件传输至于服务器，接着直接安装即可

<img src="https://z-cloud-pic-1313046262.cos.ap-guangzhou.myqcloud.com/img/202507311718529.png" alt="image-20250723181904627" style="zoom:67%;" />

# 2. 局域网环境VSCode远程连接服务器

## 2.1 SSH服务安装

1. 下载SSH服务所需的安装包（与系统版本对应）

   > 如果不清楚当前系统对应的版本可以询问豆包

   + [ncurses-term_6.2-0ubuntu2.1_all.deb](https://security.ubuntu.com/ubuntu/pool/main/n/ncurses/ncurses-term_6.2-0ubuntu2.1_all.deb)
   + [ openssh-sftp-server_8.2p1-4ubuntu0.13_amd64.deb](https://security.ubuntu.com/ubuntu/pool/main/o/openssh/openssh-sftp-server_8.2p1-4ubuntu0.13_amd64.deb)
   + [ openssh-server_8.2p1-4ubuntu0.13_amd64.deb](https://security.ubuntu.com/ubuntu/pool/main/o/openssh/openssh-server_8.2p1-4ubuntu0.13_amd64.deb)
   + [ ssh-import-id_5.10-0ubuntu1_all.deb](https://security.ubuntu.com/ubuntu/pool/main/s/ssh-import-id/ssh-import-id_5.10-0ubuntu1_all.deb)

2. 上传后执行安装命令

   > Ubuntu系统安装该服务后续开机会自启动

   ```shell
   # 安装目标路径下的所有.deb后缀安装包
   dpkg -i /目标路径/*.deb
   # 防火墙允许22号端口通过
   ufw allow 22
   # 启动SSH服务
   systemctl start ssh
   ```

## 2.2 vscode本地服务器安装

> 当VSCode开启SSH服务时，会在目标主机安装VScode本地服务器，作用是映射本地与远程的路径信息以及同步编辑行为等。在离线环境下，相关资源无法从互联网获取，因此需要手动进行干预

1. 按照如下👇方式查看自己VSCode的commit信息并保存

   > 可以理解为建立连接时的id信息

   <img src="https://z-cloud-pic-1313046262.cos.ap-guangzhou.myqcloud.com/img/202507311718578.png" alt="image-20250728102318409" style="zoom: 33%;" />

   <img src="https://z-cloud-pic-1313046262.cos.ap-guangzhou.myqcloud.com/img/202507311718515.png" alt="image-20250728102419828" style="zoom: 50%;" />

2. 浏览器分别输入以下网址，进行文件下载并创建相应文件夹

   > **commit必须进行对应替换，否则最后连接后会出现无法读取远程目录的情况！！！**

   + **vscode-server-linux-x64.tar**：`https://update.code.visualstudio.com/commit:替换为自己的commit号/server-linux-x64/stable`
   + **vscode_cli_alpine_x64_cli.tar.gz**：`https://update.code.visualstudio.com/commit:替换为自己的commit号/cli-alpine-x64/stable`

   ```shell
   # 在用户目录下创建.vscode-server/cli/servers三个文件夹
   mkdir -r ~/.vscode-server/cli/servers
   # 在servers文件夹下再创建Stable-{commit_id}文件夹
   mkdir Stable-{commit_id}
   ```

   目录层级如下所示

   <img src="https://z-cloud-pic-1313046262.cos.ap-guangzhou.myqcloud.com/img/202507311718025.png" alt="image-20250728104413292" style="zoom:50%;" />

3. 解压文件至指定目录

   ```shell
   # 将vscode-server-linux-x64.tar压缩包解压至刚刚创建的路径，commit_id进行相应替换
   tar -zxvf /目标路径/vscode-server-linux-x64.tar -C ~/.vscode-server/cli/servers/Stable-{commit_id}
   # 将vscode_cli_alpine_x64_cli.tar.gz压缩包（仅有code文件）解压到.vscode-server下
   tar -zxvf /目标路径/vscode_cli_alpine_x64_cli.tar.gz -C ~/.vscode-server
   # 将文件命名为"code-{commit_id}"，如下👇
   ```

   <img src="https://z-cloud-pic-1313046262.cos.ap-guangzhou.myqcloud.com/img/202507311718033.png" alt="image-20250728105124921" style="zoom:50%;" />

   由此即可完成vscode本地服务器配置

若后续有新的主机需要连接服务器，只需要在对应位置创建新的`Stable-{commit_id}`文件夹并解压`vscode-server-linux-x64.tar`压缩包以及解压`vscode_cli_alpine_x64_cli.tar.gz`，将其重命名为`code-{commit_id}`并将其移动到对应目录位置即可

# 3. 离线部署conda虚拟环境

如果需要在服务器离线部署Python虚拟环境（服务器要提前安装MiniConda），可参考以下步骤：

1. 寻找拥有MiniConda且联网的Linux系统，创建初始环境并指定python版本

   ```bash
   # 创建指定python版本且名为env_name的虚拟环境，安装conda-pack工具
   conda create --name env_name python=xxx conda-pack工具
   ```

   将当前基础环境进行打包

   ```bash
   # 打包env_name这个虚拟环境，只需将其解压至conda对应的envs目录下即可完成迁移
   # 注意：打包的系统需要与虚拟环境的系统一致，否则环境无法兼容
   conda pack -n env_name -o env_name.tar.gz
   ```

   利用XFtp或其他的文件传输工具将工具传输至于离线服务器的`minicoda/envs`目录下，将当前环境进行解压到指定目录即可完成基础环境的迁移

   ```shell
   # 在minicoda/envs路径下创建env_name文件夹
   mkdir -p env_name
   # 解压虚拟环境
   tar -zxvf env_name.tar.gz -C env_name
   ```

   > 可在离线服务器中存放一个仅有python的库作为环境源，后续若是需要类似的python虚拟环境只需要复制`minicoda/envs`下的环境源文件夹即可

2. 在自己的Windows电脑上安装相关依赖

   ```python
   # 安装Linux平台与python3.10匹配的requirements.txt涉及的二进制包(.whl)到当前的offline文件夹中
   pip download -r requirements.txt -d ./offline/ --platform manylinux2014_x86_64 --python-version 3.10  --only-binary=:all:
   
   # 若只想单独安装某第三方库，则使用如下命令
   # 安装Linux平台与python3.10匹配的的pandas及其相关依赖的二进制包(.whl)到当前的offline文件夹中
   pip download pandas -d ./offline/ --platform manylinux2014_x86_64 --python-version 3.10  --only-binary=:all:   
   ```

   将offline文件夹压缩传送至离线服务器

3. 离线服务器安装依赖

   ```bash
   # 切换至目标虚拟环境
   conda activate env_name
   # 根据当前的依赖生成requirements.txt文件
   ls ./offline/*.whl > requirements.txt
   # 安装所有依赖
   pip install -r requirements.txt
   ```
